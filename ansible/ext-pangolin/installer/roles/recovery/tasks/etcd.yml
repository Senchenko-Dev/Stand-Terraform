- name: Recovery etcd
  include_role:
    name: etcd
    tasks_from: revert.yml
  when: is_recovery_etcd

- name: Loop wait for etcd start
  shell: "etcdctl {{ endpoints_v2 }} {% if ssl_mode %}{{ etcdv2_ssl_connect }}{% endif %} cluster-health 2>&1"
  environment:
    ETCDCTL_API: 2
  register: result
  until: result.stdout.find("cluster is healthy") != -1
  retries: 4
  delay: 3
  run_once: true
  become: true
  when: is_recovery_etcd