- name: Clean etcd db
  block:

    - name: stop patroni service
      service:
        name: patroni
        state: stopped
      when: inventory_hostname != 'etcd'

    - name: stop etcd service
      systemd:
        name: etcd
        state: stopped
      register: result
      until: result.status.ActiveState != 'active'
      retries: 6
      delay: 10

    - name: remove etcd data dir
      file:
        path: "{{ etcd_files.data_dir }}"
        state: absent

  become: true