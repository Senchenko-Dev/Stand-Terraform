- name: Execute for all nodes
  block:

    - name: ensure {{ backup_root_dir }}{{ PGUSERHOME }}
      file:
        path: "{{ item }}"
        state: directory
        owner: postgres
        group: postgres
        mode: 0700
      with_items:
        - "{{ backup_root_dir }}{{ PGUSERHOME }}"
        - "{{ backup_root_dir }}{{ sudoers_file.split('/')[0:-1] | join ('/') }}"

    - name: backup shell profile
      copy:
        src: "{{ shell_profile_file }}"
        dest: "{{ backup_root_dir }}{{ shell_profile_file }}"
        remote_src: yes
        owner: postgres
        group: postgres

    - name: backup sudoers
      shell: "cp -p {{ sudoers_file }} {{ backup_root_dir }}{{ sudoers_file }}"

  become: true