---
- name: Setup VM
  hosts: all
  become: yes
  tasks:
#    - name: check package manager's default mirrors access

#    - name: disable all yum mirrors


    - name: setup mirror for yum
      include_role:
        name: setup_yum_repos
      when: setup_yum_repos | bool | default(false)

    - name: Add iptables ACCEPT TCP
      iptables:
        action: append
        chain: IN_public_allow
        state: present
        comment: added by ansible for Nginx
        ctstate: NEW,UNTRACKED
        jump: ACCEPT
        protocol: tcp

    - block:
        - name: Disable SELinux
          selinux:
            state: disabled
          register: selinux_result

        - reboot:
          when: selinux_result.reboot_required
