---
- name: Find file logs
  find:
    path: "{{ item }}"
    file_type: file
    recurse: yes
  with_items:
    - "{{ KLogDirs }}"
    - "{{ ZLogDirs }}"
  register: list_log_files

- name: Get IP from fact
  set_fact:
    ip: "{{ ansible_default_ipv4.address | default(ansible_all_ipv4_addresses[0]) }}"

#- name: Copy Template
#  template:
#    src: nginx.conf
#    dest: /etc/nginx
#    owner: "{{ nginx_user }}"
#    group: "{{ nginx_group }}"
#
#- name: restatrt nginx
#  shell: systemctl restart nginx
#
#- name: nginx -s reload
#  shell: nginx -s reload
#
#- name: Create folder
#  file:
#    path: /mnt/{{ item }}
#    state: directory
#    owner: "{{ nginx_user }}"
#    group: "{{ nginx_group }}"
#  with_items:
#    - /mnt/log
#    - "/mnt/kafka-{{ ip }}"
#
#- debug:
#    var: list_log_files

#- debug:
#    var: item
#   loop:

- name: fetch files to host
  fetch:
    src: "{{ item }}"
    dest: "/tmp/kafka-{{ ip }}/"
    owner: "{{ nginx_user }}"
    group: "{{ nginx_group }}"
    flat: yes
  loop:
#    - "{{ list_log_files | community.general.json_query('results.files[*].path') }}"
    - "/KAFKA/logs/kafka1/kafkaServer.out"

- name: copy log to master
  copy:
    src: "/tmp/kafka-{{ ip }}"
    dest: /mnt/log
  delegate_to: "{{ awx_host }}"

- debug:
    msg: "Логи по ссылке: http://{{ awx_host }}:{{ pod_nginx_port }}/log/ "

