---
- name: Install libunwind
  yum:
    name: libunwind
    state: latest

- name: Install ldconfig
  yum:
    name: ldconfig
    state: latest

- name: Install Unzip
  yum:
    name: unzip
    state: latest

- name: Create Group
  group:
    name: "{{ nginx_iag_group }}"
    state: present

- name: Create User
  user:
    name: "{{ nginx_iag_user }}"
    state: present
    shell: /bin/bash
    group: "{{ nginx_iag_group }}"

- name: Create Folder nginx-sgw
  file:
    path: /opt/nginx-sgw
    state: directory
    owner: "{{ nginx_iag_user }}"
    group: "{{ nginx_iag_group }}"
    mode: '0644'

- name: Create Folder nginx-sgw-install
  file:
    path: /tmp/nginx-sgw-install
    state: directory

- name: unarchive
  unarchive:
    src: "{{ download_url | basename }}"
    dest: /tmp/nginx-sgw-install

- name: Unarchive nginx-sgw.tar.gz
  unarchive:
    src: /tmp/nginx-sgw-install/package/tar/nginx-iag.tar.gz
    dest: /tmp/nginx-sgw-install
    remote_src: yes

- name: Change install dir
  lineinfile:
    dest: /tmp/nginx-sgw-install/install.options
    regexp: '^NGINXDIR'
    line: 'NGINXDIR="/opt/nginx-sgw"'

- name: Install.sh nginx-iag
  shell: ./install.sh
  args:
    chdir: /tmp/nginx-sgw-install

